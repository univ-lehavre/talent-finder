{
	"openapi": "3.0.3",
	"info": {
		"title": "Talent Finder API",
		"description": "API REST pour l'application Talent Finder",
		"version": "0.1.0"
	},
	"servers": [
		{
			"url": "/api/v1",
			"description": "API v1"
		}
	],
	"tags": [
		{
			"name": "auth",
			"description": "Authentification par magic link"
		},
		{
			"name": "user",
			"description": "Gestion des utilisateurs"
		},
		{
			"name": "consent",
			"description": "Gestion du consentement utilisateur"
		},
		{
			"name": "institutions",
			"description": "Recherche d'institutions de recherche via OpenAlex"
		},
		{
			"name": "openalex",
			"description": "Statistiques OpenAlex pour les institutions (nécessite authentification et consentement)"
		},
		{
			"name": "repository",
			"description": "Statistiques du dépôt git"
		},
		{
			"name": "github",
			"description": "Intégration GitHub"
		}
	],
	"paths": {
		"/auth/signup": {
			"post": {
				"operationId": "signupWithEmail",
				"summary": "Inscription par email",
				"description": "Envoie un magic link à l'adresse email fournie pour créer un compte.",
				"tags": ["auth"],
				"requestBody": {
					"required": true,
					"content": {
						"application/json": {
							"schema": {
								"type": "object",
								"required": ["email"],
								"properties": {
									"email": {
										"type": "string",
										"format": "email",
										"description": "Adresse email de l'utilisateur"
									}
								}
							}
						}
					}
				},
				"responses": {
					"200": {
						"description": "Magic link envoyé",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/SignupSuccess"
								}
							}
						}
					},
					"400": {
						"description": "Email invalide",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					}
				}
			}
		},
		"/auth/login": {
			"post": {
				"operationId": "loginWithMagicLink",
				"summary": "Connexion avec magic link",
				"description": "Valide le magic link et crée une session utilisateur.",
				"tags": ["auth"],
				"requestBody": {
					"required": true,
					"content": {
						"application/json": {
							"schema": {
								"type": "object",
								"required": ["userId", "secret"],
								"properties": {
									"userId": {
										"type": "string",
										"description": "ID utilisateur du magic link"
									},
									"secret": {
										"type": "string",
										"description": "Secret du magic link"
									}
								}
							}
						}
					}
				},
				"responses": {
					"200": {
						"description": "Connexion réussie",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/LoginSuccess"
								}
							}
						}
					},
					"400": {
						"description": "Paramètres invalides",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					}
				}
			}
		},
		"/auth/logout": {
			"post": {
				"operationId": "logout",
				"summary": "Déconnexion",
				"description": "Termine la session utilisateur courante.",
				"tags": ["auth"],
				"responses": {
					"200": {
						"description": "Déconnexion réussie",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/LogoutSuccess"
								}
							}
						}
					},
					"401": {
						"description": "Non authentifié",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					}
				}
			}
		},
		"/me": {
			"get": {
				"operationId": "getCurrentUser",
				"summary": "Profil utilisateur courant",
				"description": "Retourne les informations du profil de l'utilisateur authentifié.",
				"tags": ["user"],
				"responses": {
					"200": {
						"description": "Profil utilisateur",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/User"
								}
							}
						}
					},
					"401": {
						"description": "Non authentifié",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					}
				}
			}
		},
		"/repository": {
			"get": {
				"operationId": "getRepositoryStats",
				"summary": "Statistiques du dépôt",
				"description": "Retourne les statistiques complètes du dépôt git : commits, code, tests, GitHub.",
				"tags": ["repository"],
				"responses": {
					"200": {
						"description": "Statistiques du dépôt",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/RepositoryStats"
								}
							}
						}
					},
					"500": {
						"description": "Erreur serveur",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					}
				}
			}
		},
		"/github": {
			"get": {
				"operationId": "getGitHubInfo",
				"summary": "Informations GitHub",
				"description": "Retourne les statistiques GitHub (issues, PRs) et les URLs du dépôt.",
				"tags": ["github"],
				"responses": {
					"200": {
						"description": "Informations GitHub",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/GitHubInfo"
								}
							}
						}
					},
					"500": {
						"description": "Erreur serveur",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					}
				}
			}
		},
		"/institutions/search": {
			"get": {
				"operationId": "searchInstitutions",
				"summary": "Rechercher des institutions",
				"description": "Recherche des institutions de recherche via l'API OpenAlex (autocomplete). Retourne jusqu'à 10 résultats.",
				"tags": ["institutions"],
				"parameters": [
					{
						"name": "q",
						"in": "query",
						"required": true,
						"schema": {
							"type": "string",
							"minLength": 1
						},
						"description": "Terme de recherche (nom de l'institution)"
					}
				],
				"responses": {
					"200": {
						"description": "Résultats de recherche",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/InstitutionSearchResponse"
								}
							}
						}
					},
					"502": {
						"description": "Erreur API OpenAlex",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					}
				}
			}
		},
		"/consent": {
			"get": {
				"operationId": "getConsentStatus",
				"summary": "Obtenir le statut du consentement",
				"description": "Retourne le statut actuel du consentement pour l'utilisateur authentifié.",
				"tags": ["consent"],
				"parameters": [
					{
						"name": "type",
						"in": "query",
						"required": true,
						"schema": {
							"type": "string",
							"enum": ["openalex_email"]
						},
						"description": "Type de consentement (ex: openalex_email)"
					}
				],
				"responses": {
					"200": {
						"description": "Statut du consentement",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ConsentStatus"
								}
							}
						}
					},
					"400": {
						"description": "Paramètre manquant ou invalide",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					},
					"401": {
						"description": "Non authentifié",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					}
				}
			},
			"post": {
				"operationId": "updateConsent",
				"summary": "Accorder ou révoquer un consentement",
				"description": "Accorde ou révoque le consentement pour l'utilisateur authentifié.",
				"tags": ["consent"],
				"requestBody": {
					"required": true,
					"content": {
						"application/json": {
							"schema": {
								"type": "object",
								"required": ["type", "action"],
								"properties": {
									"type": {
										"type": "string",
										"enum": ["openalex_email"],
										"description": "Type de consentement"
									},
									"action": {
										"type": "string",
										"enum": ["grant", "revoke"],
										"description": "Action à effectuer"
									}
								}
							}
						}
					}
				},
				"responses": {
					"200": {
						"description": "Consentement mis à jour",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ConsentStatus"
								}
							}
						}
					},
					"400": {
						"description": "Paramètre manquant ou invalide",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					},
					"401": {
						"description": "Non authentifié",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					}
				}
			}
		},
		"/openalex/institution-stats": {
			"get": {
				"operationId": "getInstitutionStats",
				"summary": "Statistiques des institutions",
				"description": "Retourne des statistiques complètes pour les institutions spécifiées : nombre de publications, articles par année, nombre d'auteurs. Utilise le polite pool OpenAlex avec l'email de l'utilisateur.",
				"tags": ["openalex"],
				"parameters": [
					{
						"name": "institutions",
						"in": "query",
						"required": true,
						"schema": {
							"type": "string"
						},
						"description": "IDs OpenAlex des institutions, séparés par des virgules (max 10)"
					}
				],
				"responses": {
					"200": {
						"description": "Statistiques des institutions",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/InstitutionStatsResponse"
								}
							}
						}
					},
					"400": {
						"description": "Paramètre manquant ou invalide",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					},
					"401": {
						"description": "Non authentifié",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					},
					"403": {
						"description": "Consentement requis",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					},
					"502": {
						"description": "Erreur API OpenAlex",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					}
				}
			}
		},
		"/openalex/works-count": {
			"get": {
				"operationId": "getWorksCount",
				"summary": "Nombre de publications",
				"description": "Retourne le nombre de publications des institutions spécifiées sur les 5 dernières années. Utilise le polite pool OpenAlex avec l'email de l'utilisateur.",
				"tags": ["openalex"],
				"parameters": [
					{
						"name": "institutions",
						"in": "query",
						"required": true,
						"schema": {
							"type": "string"
						},
						"description": "IDs OpenAlex des institutions, séparés par des virgules (max 10)"
					}
				],
				"responses": {
					"200": {
						"description": "Comptage des publications",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/WorksCountResponse"
								}
							}
						}
					},
					"400": {
						"description": "Paramètre manquant ou invalide",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					},
					"401": {
						"description": "Non authentifié",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					},
					"403": {
						"description": "Consentement requis",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					},
					"502": {
						"description": "Erreur API OpenAlex",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ApiError"
								}
							}
						}
					}
				}
			}
		}
	},
	"components": {
		"schemas": {
			"ApiError": {
				"type": "object",
				"required": ["code", "message"],
				"properties": {
					"code": {
						"type": "string",
						"description": "Code d'erreur machine"
					},
					"message": {
						"type": "string",
						"description": "Message d'erreur lisible"
					},
					"cause": {
						"type": "string",
						"description": "Cause technique (optionnel)"
					}
				}
			},
			"SignupSuccess": {
				"type": "object",
				"properties": {
					"signedUp": {
						"type": "boolean"
					},
					"createdAt": {
						"type": "string",
						"format": "date-time"
					}
				}
			},
			"LoginSuccess": {
				"type": "object",
				"properties": {
					"loggedIn": {
						"type": "boolean"
					}
				}
			},
			"LogoutSuccess": {
				"type": "object",
				"properties": {
					"loggedOut": {
						"type": "boolean"
					}
				}
			},
			"User": {
				"type": "object",
				"properties": {
					"id": {
						"type": "string"
					},
					"email": {
						"type": "string",
						"format": "email",
						"nullable": true
					},
					"labels": {
						"type": "array",
						"items": {
							"type": "string"
						}
					}
				}
			},
			"CodeStats": {
				"type": "object",
				"properties": {
					"files": {
						"type": "integer"
					},
					"constants": {
						"type": "integer"
					},
					"functions": {
						"type": "integer"
					},
					"types": {
						"type": "integer"
					}
				}
			},
			"TestStats": {
				"type": "object",
				"properties": {
					"files": {
						"type": "integer"
					},
					"describes": {
						"type": "integer"
					},
					"tests": {
						"type": "integer"
					}
				}
			},
			"GitHubItemStats": {
				"type": "object",
				"properties": {
					"open": {
						"type": "integer"
					},
					"closed": {
						"type": "integer"
					}
				}
			},
			"PeriodStats": {
				"type": "object",
				"properties": {
					"period": {
						"type": "string",
						"description": "Format ISO: YYYY-MM-DDTHH"
					},
					"commits": {
						"type": "integer"
					},
					"additions": {
						"type": "integer"
					},
					"deletions": {
						"type": "integer"
					},
					"filesChanged": {
						"type": "integer"
					},
					"authors": {
						"type": "array",
						"items": {
							"type": "string"
						}
					}
				}
			},
			"RepositoryStats": {
				"type": "object",
				"properties": {
					"totalCommits": {
						"type": "integer"
					},
					"totalAdditions": {
						"type": "integer"
					},
					"totalDeletions": {
						"type": "integer"
					},
					"firstCommitDate": {
						"type": "string",
						"format": "date-time",
						"nullable": true
					},
					"lastCommitDate": {
						"type": "string",
						"format": "date-time",
						"nullable": true
					},
					"currentCode": {
						"$ref": "#/components/schemas/CodeStats"
					},
					"currentTests": {
						"$ref": "#/components/schemas/TestStats"
					},
					"hourlyStats": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/PeriodStats"
						}
					},
					"github": {
						"type": "object",
						"properties": {
							"issues": {
								"$ref": "#/components/schemas/GitHubItemStats"
							},
							"pullRequests": {
								"$ref": "#/components/schemas/GitHubItemStats"
							},
							"repoUrl": {
								"type": "string",
								"nullable": true
							}
						}
					}
				}
			},
			"GitHubUrls": {
				"type": "object",
				"properties": {
					"repository": {
						"type": "string",
						"nullable": true
					},
					"issues": {
						"type": "string",
						"nullable": true
					},
					"newIssue": {
						"type": "string",
						"nullable": true
					},
					"pullRequests": {
						"type": "string",
						"nullable": true
					},
					"discussions": {
						"type": "string",
						"nullable": true
					}
				}
			},
			"GitHubInfo": {
				"type": "object",
				"properties": {
					"stats": {
						"type": "object",
						"properties": {
							"issues": {
								"$ref": "#/components/schemas/GitHubItemStats"
							},
							"pullRequests": {
								"$ref": "#/components/schemas/GitHubItemStats"
							}
						}
					},
					"urls": {
						"$ref": "#/components/schemas/GitHubUrls"
					}
				}
			},
			"Institution": {
				"type": "object",
				"required": ["id", "displayName", "citedByCount"],
				"properties": {
					"id": {
						"type": "string",
						"description": "OpenAlex ID de l'institution"
					},
					"displayName": {
						"type": "string",
						"description": "Nom de l'institution"
					},
					"location": {
						"type": "string",
						"nullable": true,
						"description": "Localisation (ville, pays)"
					},
					"citedByCount": {
						"type": "integer",
						"description": "Nombre de citations"
					},
					"worksCount": {
						"type": "integer",
						"nullable": true,
						"description": "Nombre de publications"
					}
				}
			},
			"InstitutionSearchResponse": {
				"type": "object",
				"required": ["institutions", "meta"],
				"properties": {
					"institutions": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/Institution"
						},
						"description": "Liste des institutions trouvées (max 10)"
					},
					"meta": {
						"type": "object",
						"properties": {
							"count": {
								"type": "integer",
								"description": "Nombre de résultats"
							},
							"responseTimeMs": {
								"type": "integer",
								"description": "Temps de réponse en millisecondes"
							}
						}
					}
				}
			},
			"ConsentStatus": {
				"type": "object",
				"required": ["consentType", "granted", "updatedAt"],
				"properties": {
					"consentType": {
						"type": "string",
						"enum": ["openalex_email"],
						"description": "Type de consentement"
					},
					"granted": {
						"type": "boolean",
						"nullable": true,
						"description": "true si accordé, false si révoqué, null si jamais demandé"
					},
					"updatedAt": {
						"type": "string",
						"format": "date-time",
						"nullable": true,
						"description": "Date de dernière mise à jour (ISO 8601)"
					}
				}
			},
			"YearlyArticleCount": {
				"type": "object",
				"required": ["year", "count"],
				"properties": {
					"year": {
						"oneOf": [
							{
								"type": "integer",
								"description": "Année de publication (ex: 2024)"
							},
							{
								"type": "string",
								"enum": ["before"],
								"description": "Articles antérieurs à la période affichée"
							}
						],
						"description": "Année ou 'before' pour les articles plus anciens"
					},
					"count": {
						"type": "integer",
						"description": "Nombre d'articles"
					}
				}
			},
			"InstitutionStatsResponse": {
				"type": "object",
				"required": [
					"worksCount",
					"articlesCount",
					"articlesByYear",
					"authorsCount",
					"responseTimeMs",
					"institutionCount"
				],
				"properties": {
					"worksCount": {
						"type": "integer",
						"description": "Nombre total de publications (tous types)"
					},
					"articlesCount": {
						"type": "integer",
						"description": "Nombre d'articles (type:article uniquement)"
					},
					"articlesByYear": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/YearlyArticleCount"
						},
						"description": "Décompte des articles par année"
					},
					"authorsCount": {
						"type": "integer",
						"description": "Nombre d'auteurs distincts affiliés aux institutions"
					},
					"responseTimeMs": {
						"type": "integer",
						"description": "Temps de réponse total en millisecondes"
					},
					"institutionCount": {
						"type": "integer",
						"description": "Nombre d'institutions interrogées"
					}
				}
			},
			"WorksCountResponse": {
				"type": "object",
				"required": ["count", "responseTimeMs", "fromDate", "institutionCount"],
				"properties": {
					"count": {
						"type": "integer",
						"description": "Nombre de publications"
					},
					"responseTimeMs": {
						"type": "integer",
						"description": "Temps de réponse en millisecondes"
					},
					"fromDate": {
						"type": "string",
						"description": "Date de début de la période (format YYYY-MM-DD)"
					},
					"institutionCount": {
						"type": "integer",
						"description": "Nombre d'institutions interrogées"
					}
				}
			}
		}
	}
}
